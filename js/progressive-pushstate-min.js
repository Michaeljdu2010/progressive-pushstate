var pp=new function(){function debounce(func,wait){var timeout;return function(){var context=this,args=arguments,callback=function(){func.apply(context,args)};clearTimeout(timeout),timeout=setTimeout(callback,wait)}}function getScrollLeft(){return void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft}function getScrollTop(){return void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}function scrollEvent(e){if(window.history.replaceState){var url=window.history.href,state=(getScrollLeft(),getScrollTop(),me.lastState);window.history.replaceState(state,"",url)}}function internalPopstateEvent(e){var state,formEls=document.getElementsByClassName("pp-form");state=null!==me.options.defaultState&&null===e.state?me.options.defaultState:e.state,0!==formEls.length&&updateForms(state),me.popstateEvent(e,state),me.lastState=state}function updateSetValueInput(el,stateValues,isCheckbox){var i,stateValue,checked=!1;for(i=0;i<stateValues.length;i++)stateValue=stateValues[i],stateValue===el.value&&(checked=!0);isCheckbox?el.checked=checked:el.selected=checked}function updateForms(state){var h,i,j,formEls=document.getElementsByClassName("pp-form");for(state=state||{},h=0;h<formEls.length;h++){var formEl=formEls[h],fields=formEl.elements,numEl=fields.length,updatedNames={};for(i=0;i<numEl;i++){var field=fields[i],name=field.name,stateVal=state[name]||"";if(!updatedNames[name]){switch(field.type){case"submit":break;case"radio":case"select-multiple":case"select-one":case"checkbox":var isCheckbox="checkbox"===field.type||"radio"===field.type,allElementsWithName=isCheckbox?formEl.elements[name]:field.options,elsLen=allElementsWithName.length;if("object"!=typeof stateVal&&(stateVal=[stateVal]),allElementsWithName.length)for(j=0;j<elsLen;j++){var el=allElementsWithName[j];updateSetValueInput(el,stateVal,isCheckbox)}else updateSetValueInput(allElementsWithName,stateVal,isCheckbox);break;default:field.value=stateVal}updatedNames[name]=!0}}}}function linkClickEvent(e){var target=e.target,updateOptions={isMerge:hasClass(target,"pp-merge")};if("A"===target.nodeName&&target.classList.contains("pp-link")){var URL=target.href,splitURL=URL.split("?");if(2===splitURL.length){var qs=splitURL[1];e.preventDefault(),me.updatePushState(e,qs,updateOptions)}}}function hasClass(target,className){return new RegExp("(\\s|^)"+className+"(\\s|$)").test(target.className)}function formChangeEvent(e){var target,targetForm,qs,updateOptions,formEls=document.getElementsByClassName("pp-form");if(target=0===e.type.indexOf("key")?e.currentTarget||e.target.form:e.target,targetForm=target.form,updateOptions={isMerge:hasClass(targetForm,"pp-merge")},(!target.form||(target=target.form,hasClass(target,"pp-form")))&&(qs=me.formData2QueryString(target,{collapseMulti:me.options.collapseMulti}),me.updatePushState(e,qs,updateOptions),"submit"===e.type)){for(var i=0;i<formEls.length;i++){var autoFocusEl=formEls[i].querySelector("input[autofocus], textarea[autofocus], select[autofocus]");if(autoFocusEl){autoFocusEl.focus();break}}e.preventDefault()}}function getBaseUrl(){var loc=window.location;return loc.protocol+"//"+loc.host+loc.pathname}function queryStringToObject(qs){var i,j,hashSplit=qs.split("#"),qsFrags=hashSplit[0].split("&"),qsFragsLen=qsFrags.length,r={};for(i=0;i<qsFragsLen;i++){var qsFrag=qsFrags[i],splitFrag=qsFrag.split("="),name=decodeURIComponent(splitFrag[0]),rawValue=splitFrag[1],oldValue=r[name];if(me.options.collapseMulti){var splitValue=rawValue.split(",");if(splitValue.length>1){for(j=0;j<splitValue.length;j++)splitValue[j]=decodeURIComponent(splitValue[j]);r[name]=splitValue}else r[name]=decodeURIComponent(rawValue)}else{var decodedValue=decodeURIComponent(rawValue);if(oldValue)switch(typeof oldValue){case"string":r[name]=[oldValue,decodedValue];break;case"object":r[name].push(decodedValue);break;default:r[name]=decodedValue}else r[name]=decodedValue}}return hashSplit.length>1&&(r._ppHash=hashSplit[1]),r}function getNormalizedObject(obj){var i,r={};for(i in obj)obj[i]&&(r[i]=obj[i]);return r}var me=this,orientation=screen.orientation||screen.mozOrientation||screen.msOrientation,spaceRe=/\s+/g,ampRe=/&/g,ltRe=/</g,gtRe=/>/g,ampEntRe=/&amp;/g,ltEntRe=/&lt;/g,gtEntRe=/&gt;/g;me.lastState={},me.popstateEvent=function(e,state){},me.options={},me.init=function(popstateEvent,options){me.options=options||{};var params,j,formEls=document.getElementsByClassName("pp-form"),formElsLen=formEls.length;for(me.options=options||{},me.defaultEl=document.getElementsByClassName("pp-default"),me.popstateEvent=popstateEvent,document.addEventListener("click",linkClickEvent),me.formChangeEventDebounced=debounce(formChangeEvent,me.options.keyDebounceTime||500),j=0;j<formElsLen;j++){var formEl=formEls[j];me.initForm(formEl)}if(me.defaultEl.length>0&&(me.options.defaultState=queryStringToObject(me.defaultEl[0].href.split("?")[1])),window.addEventListener("popstate",internalPopstateEvent),me.options.pushScrollState&&(me.scrollEventDebounced=debounce(scrollEvent,me.options.debounceTime||50),window.addEventListener("scroll",me.scrollEventDebounced),window.addEventListener("resize",me.scrollEventDebounced),orientation?orientation.addEventListener("change",me.scrollEvent):window.addEventListener("orientationchange",me.scrollEvent)),me.options.doPopstateOnload&&window.history.replaceState){var splitLocation=location.href.split("?");params=2===splitLocation.length?queryStringToObject(splitLocation[1]):{},window.history.replaceState(params,"",window.location.href),0!==formEls.length&&updateForms(params),me.popstateEvent({type:"init",target:document,currentTarget:document,state:params}),me.lastState=params}},me.initForm=function(formEl){var events=formEl.getAttribute("data-pp-events")||"change";formEl.elements;if(events){events=events.split(spaceRe);var eventsLen=events.length;for(i=0;i<eventsLen;i++){var event=events[i];0===event.indexOf("key")?document.addEventListener(events[i],me.formChangeEventDebounced):document.addEventListener(events[i],formChangeEvent)}}else formEl.addEventListener("submit",formChangeEvent)},me.unentify=function(s){return s.replace(ampEntRe,"&").replace(ltEntRe,"<").replace(gtEntRe,">")},me.entify=function(s,options){return s.replace(ampRe,"&amp;").replace(ltRe,"&lt;").replace(gtRe,"&gt;")},me.updatePushState=function(e,qs,options){var target=e.currentTarget||e.target,formEls=document.getElementsByClassName("pp-form");switch(options=options||{},e.type){case"submit":case"click":e.preventDefault()}var params=queryStringToObject(qs);if(void 0===me.lastState._ppPageNum&&void 0===e.state?params._ppPageNum=0:"popstate"!==e.type&&(params._ppPageNum=me.lastState._ppPageNum+1),window.history.pushState){var newUrl=getBaseUrl()+"?"+qs;options.isMerge&&(params=Object.assign(getNormalizedObject(window.history.state),params)),window.history.pushState(params,"",newUrl),e.state=params,0!==formEls.length&&"FORM"!==target.nodeName&&updateForms(params),me.popstateEvent(e,params),me.lastState=params}},me.sortObject=function(obj){return Object.keys(obj).sort().reduce(function(result,key){return result[key]=obj[key],result},{})},me.formData2QueryString=function(docForm,formatOpts){var formElem,opts=formatOpts||{},str="",lastElemName="";for(i=0;i<docForm.elements.length;i++)if(formElem=docForm.elements[i],formElem.name)switch(formElem.type){case"select-multiple":for(var isSet=!1,j=0;j<formElem.options.length;j++){var currOpt=formElem.options[j];currOpt.selected&&(opts.collapseMulti?isSet?str+=","+encodeURIComponent(currOpt.value):(str+=formElem.name+"="+encodeURIComponent(currOpt.value),isSet=!0):str+=formElem.name+"="+encodeURIComponent(currOpt.value)+"&")}opts.collapseMulti&&(str+="&");break;case"radio":formElem.checked&&(str+=formElem.name+"="+encodeURIComponent(formElem.value)+"&");break;case"checkbox":formElem.checked&&(opts.collapseMulti&&formElem.name==lastElemName?(str.lastIndexOf("&")==str.length-1&&(str=str.substr(0,str.length-1)),str+=","+encodeURIComponent(formElem.value)):str+=formElem.name+"="+encodeURIComponent(formElem.value),str+="&",lastElemName=formElem.name);break;default:str+=formElem.name+"="+encodeURIComponent(formElem.value)+"&"}return str=str.substr(0,str.length-1)},me.isInStateProperty=function(property,value){if(void 0===property)return!1;var i,propType=typeof property;if("string"===propType&&property===value)return!0;if("object"===propType)for(i=0;i<property.length;i++)if(property[i]===value)return!0;return!1}};"function"!=typeof Element.prototype.matches&&(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.webkitMatchesSelector||function(selector){for(var element=this,elements=(element.document||element.ownerDocument).querySelectorAll(selector),index=0;elements[index]&&elements[index]!==element;)++index;return Boolean(elements[index])}),"function"!=typeof Element.prototype.closest&&(Element.prototype.closest=function(selector){for(var element=this;element&&1===element.nodeType;){if(element.matches(selector))return element;element=element.parentNode}return null}),"function"!=typeof Object.assign&&(Object.assign=function(target,varArgs){"use strict";if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=1;index<arguments.length;index++){var nextSource=arguments[index];if(null!=nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to});
